<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmailJS Test - Moviegrtr</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .config-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .config-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .config-label {
            font-weight: bold;
            color: #555;
        }
        .config-value {
            color: #333;
            font-family: monospace;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success {
            background: #10b981;
            color: white;
        }
        .status.error {
            background: #ef4444;
            color: white;
        }
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }
        button:hover {
            background: #5568d3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        .instructions {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #856404;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 8px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìß EmailJS Test Page</h1>
        <p class="subtitle">Test your email notification setup for Moviegrtr</p>

        <div class="instructions">
            <h3>üìã How to Test</h3>
            <ol>
                <li>Check the configuration status below</li>
                <li>Enter your email address</li>
                <li>Click "Run Configuration Test"</li>
                <li>Click "Send Test Email"</li>
                <li>Check your inbox (and spam folder)</li>
            </ol>
        </div>

        <div class="config-section">
            <h3>‚öôÔ∏è Configuration Status</h3>
            <div class="config-item">
                <span class="config-label">Service ID:</span>
                <span class="config-value" id="serviceId">Loading...</span>
            </div>
            <div class="config-item">
                <span class="config-label">Template ID:</span>
                <span class="config-value" id="templateId">Loading...</span>
            </div>
            <div class="config-item">
                <span class="config-label">Public Key:</span>
                <span class="config-value" id="publicKey">Loading...</span>
            </div>
            <div class="config-item">
                <span class="config-label">EmailJS Package:</span>
                <span id="packageStatus">Loading...</span>
            </div>
        </div>

        <div>
            <label for="testEmail"><strong>Your Email Address:</strong></label>
            <input type="email" id="testEmail" placeholder="your.email@example.com">
            
            <button id="testConfigBtn">üîç Run Configuration Test</button>
            <button id="sendTestBtn">üìß Send Test Email</button>
        </div>

        <div class="log" id="log">Console output will appear here...</div>
    </div>

    <script type="module">
        const log = (message, type = 'info') => {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            logEl.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        };

        // Check configuration on load
        window.addEventListener('load', async () => {
            log('Page loaded, checking configuration...');
            
            // Display env variables
            const serviceId = 'service_ptezuw3';
            const templateId = 'template_3c5zryf';
            const publicKey = '37_XtPYJCDpBe5k5y';
            
            document.getElementById('serviceId').textContent = serviceId;
            document.getElementById('templateId').textContent = templateId;
            document.getElementById('publicKey').textContent = publicKey.substring(0, 10) + '...';
            
            // Load EmailJS library
            try {
                await loadEmailJSLibrary();
                document.getElementById('packageStatus').innerHTML = '<span class="status success">‚úì Available (CDN)</span>';
                log('EmailJS library loaded successfully', 'success');
            } catch (error) {
                document.getElementById('packageStatus').innerHTML = '<span class="status error">‚úó Not Available</span>';
                log('EmailJS library failed to load: ' + error.message, 'error');
            }
        });

        // Test configuration
        document.getElementById('testConfigBtn').addEventListener('click', async () => {
            log('=== CONFIGURATION TEST STARTED ===');
            
            const serviceId = 'service_ptezuw3';
            const templateId = 'template_3c5zryf';
            const publicKey = '37_XtPYJCDpBe5k5y';
            
            log('Service ID: ' + serviceId);
            log('Template ID: ' + templateId);
            log('Public Key: ' + publicKey.substring(0, 10) + '...');
            
            try {
                // Load EmailJS from CDN
                if (!window.emailjs) {
                    await loadEmailJSLibrary();
                }
                
                log('EmailJS library imported successfully', 'success');
                
                window.emailjs.init(publicKey);
                log('EmailJS initialized with public key', 'success');
                
                log('=== CONFIGURATION TEST PASSED ===', 'success');
            } catch (error) {
                log('Configuration test failed: ' + error.message, 'error');
                log('Error stack: ' + error.stack, 'error');
                log('=== CONFIGURATION TEST FAILED ===', 'error');
            }
        });

        // Function to load EmailJS library
        const loadEmailJSLibrary = () => {
            return new Promise((resolve, reject) => {
                if (window.emailjs) {
                    resolve(window.emailjs);
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js';
                script.onload = () => {
                    if (window.emailjs) {
                        resolve(window.emailjs);
                    } else {
                        reject(new Error('EmailJS failed to load'));
                    }
                };
                script.onerror = () => reject(new Error('Failed to load EmailJS script'));
                document.head.appendChild(script);
            });
        };

        // Send test email
        document.getElementById('sendTestBtn').addEventListener('click', async () => {
            const emailInput = document.getElementById('testEmail').value;
            
            if (!emailInput) {
                alert('Please enter your email address');
                return;
            }
            
            log('=== SENDING TEST EMAIL ===');
            log('Recipient: ' + emailInput);
            
            const serviceId = 'service_ptezuw3';
            const templateId = 'template_3c5zryf';
            const publicKey = '37_XtPYJCDpBe5k5y';
            
            try {
                // Load EmailJS library
                if (!window.emailjs) {
                    log('Loading EmailJS library...');
                    await loadEmailJSLibrary();
                    log('EmailJS library loaded', 'success');
                }
                
                // Initialize EmailJS
                window.emailjs.init(publicKey);
                log('EmailJS initialized', 'success');
                
                const templateParams = {
                    to_email: emailInput,
                    to_name: 'Test User',
                    from_name: 'Moviegrtr Test System',
                    group_name: 'Test Group',
                    movie_title: 'The Matrix',
                    movie_overview: 'This is a TEST email from Moviegrtr! If you receive this, your email setup is working correctly.',
                    movie_rating: '8.7'
                };
                
                log('Template parameters prepared');
                log('Sending email via EmailJS...');
                
                const result = await window.emailjs.send(serviceId, templateId, templateParams);
                
                log('Email sent successfully!', 'success');
                log('Response: ' + JSON.stringify(result), 'success');
                log('=== TEST EMAIL SENT ===', 'success');
                
                alert('‚úÖ Test email sent successfully!\n\nCheck your inbox at: ' + emailInput + '\n\n(Also check your spam folder)');
            } catch (error) {
                log('Failed to send test email: ' + error.message, 'error');
                log('Error text: ' + (error.text || 'N/A'), 'error');
                log('Error details: ' + JSON.stringify(error), 'error');
                log('=== TEST EMAIL FAILED ===', 'error');
                
                alert('‚ùå Failed to send test email:\n\n' + (error.text || error.message));
            }
        });
    </script>
</body>
</html>
